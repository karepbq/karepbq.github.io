<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Protocol buffer for iOS · Kare'note</title><meta name="description" content="Protocol buffer for iOS - Kare"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.karepbq.com/atom.xml" title="Kare'note"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Protocol buffer for iOS</h1><div class="post-info">Aug 28, 2017</div><div class="post-content"><h3 id="Protocol-buffer-简单简介"><a href="#Protocol-buffer-简单简介" class="headerlink" title="Protocol buffer 简单简介"></a>Protocol buffer 简单简介</h3><p>protocol buffer是Google发布的轻便高效的结构化数据存储格式，与平台无关，内部采用了特殊的算法，让数据包边的更小，如果在网络传输时，有可能你会用到它。<a href="https://developers.google.com/protocol-buffers/" target="_blank" rel="external">官方网址</a></p>
<h2 id="这里只讲如何引用-不讲过多代码"><a href="#这里只讲如何引用-不讲过多代码" class="headerlink" title="这里只讲如何引用, 不讲过多代码"></a>这里只讲如何引用, 不讲过多代码</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>可以参考这个文章，将的很详细。<a href="https://www.ibm.com/developerworks/cn/linux/l-cn-gpb/" target="_blank" rel="external">原理</a></p>
<h3 id="支持平台"><a href="#支持平台" class="headerlink" title="支持平台"></a>支持平台</h3><p>期初支持很少的平台，但是目前已经支持很多平台，诸如：Java, Object-c, Pythod, PHP 等。<br>具体可以在这里找到<a href="https://github.com/google/protobuf/releases" target="_blank" rel="external">支持平台</a>，当然<a href="https://github.com/google/protobuf" target="_blank" rel="external">git</a>项目的简介里面也会讲到支出的平台。</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>具体使用有两种方式</p>
<ol>
<li>使用CocoaPod, 具体操作可以看<a href="https://github.com/alexeyxo/protobuf-objc" target="_blank" rel="external">这里的文章</a>。</li>
<li>使用源码添加到项目</li>
</ol>
<p>我们着重讲一下，具体用代码的方式添加使用。</p>
<h3 id="Protoc-安装"><a href="#Protoc-安装" class="headerlink" title="Protoc 安装"></a>Protoc 安装</h3><p>在这之前我们需要安装一些工具包，这些工具包都是本地生产 Protoc 命令所要使用到的。在使用 protoc 生成文件之前，必须确保安装了以下工具包。不然就不会成功。具体安装命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">brew install automake</div><div class="line">brew install libtool</div><div class="line">brew install protobuf</div></pre></td></tr></table></figure>
<h3 id="具体生成-protoc"><a href="#具体生成-protoc" class="headerlink" title="具体生成 protoc"></a>具体生成 protoc</h3><p>去<a href="https://github.com/google/protobuf/releases" target="_blank" rel="external">官网</a>下载源码后，分别运行一下命令：<br><img src="images/protobufimg.png" alt="下载包截图"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">unzip protobuf-objectivec-3.4.0.zip</div><div class="line">cd protobuf-3.4.0</div><div class="line">./configure</div><div class="line">make</div><div class="line">make check</div><div class="line">sudo make install</div></pre></td></tr></table></figure>
<p>安装完毕，不出意外，在就可以在 iTerminal 里面打出 protoc<br>具体：<img src="images/protol.png" alt="protol图片"></p>
<h3 id="生产protocol文件"><a href="#生产protocol文件" class="headerlink" title="生产protocol文件"></a>生产protocol文件</h3><ol>
<li>创建 <code>.proto</code> 文件，具体格式数据类型要求可以参考 <a href="https://developers.google.com/protocol-buffers/docs/encoding" target="_blank" rel="external">encoding</a>  <code>[Note: proto3 和 proto2 规范是不同的]</code></li>
<li>这里我就创建了两个字段，文件名称为 <code>Person.proto</code><br><img src="images/protocolfield.png" alt="protocol field"></li>
<li>运行 <code>protoc --proto_path=. --objc_out=. Person.proto</code> 会生产两个文件 <code>Person.pbobjc.h</code> 和 <code>Person.pbobjc.m</code></li>
</ol>
<h3 id="项目引用"><a href="#项目引用" class="headerlink" title="项目引用"></a>项目引用</h3><ol>
<li><p>建立项目 ProtocolBF</p>
</li>
<li><p>在项目里面创建 ProtocloBufferFile 文件夹</p>
</li>
<li><p>把 protobuf-3.4.0/objectivec 下的全部内容复制到<br>ProtocloBufferFile 文件夹中 (你可以自行去掉Test部分，当然也可以不去掉，这取决于你)<br><img src="images/pro.png" alt="pro图片"></p>
</li>
<li><p>在项目里面添加文件 <img src="images/addpro1.png" alt="add file"></p>
</li>
<li><p>添加<code>libProtocolBuffers.a</code> <img src="images/addpro2.png" alt="add file"></p>
</li>
<li><p>添加<code>Header search paths</code><br><code>格式为：$(PROJECT)/存放protobuf文件的目录名称</code>，在这里是<code>ProtocloBufferFile</code>，也就是<code>$(PROJECT)/ProtocloBufferFile</code> <img src="images/addpro3.png" alt="add file"></p>
</li>
</ol>
<ol>
<li><p>然后添加生成的Person.pbobjc.* 文件以及 Person.proto 文件, 因为 他不支持Arc 所以的加上 <code>-fno-objc-arc</code><br><img src="images/addpro4.png" alt="add file"></p>
</li>
<li><p>然后编译成功。</p>
<h3 id="具体应用代码"><a href="#具体应用代码" class="headerlink" title="具体应用代码"></a>具体应用代码</h3><p>这里主要讲了引用，具体用法还得自己去研究哦！<br><img src="images/detailsimport.png" alt="add file"></p>
<p>代码<a href="https://github.com/karepbq/ProtocolBuffer" target="_blank" rel="external">Github</a></p>
</li>
</ol>
</div></article></div></main><footer><div class="paginator"><a href="/2017/10/19/删除远程分支命令解读/" class="prev">PREV</a><a href="/2017/08/05/Rust/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://www.karepbq.com">Kare</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>